name: "app-development"
title: "ERPNext App Development Workflow"
description: "Complete workflow for developing ERPNext applications using BMAD agents"
version: "1.0.0"

workflow_stages:
  1_requirements_analysis:
    name: "Requirements Analysis"
    description: "Analyze business requirements and define scope"
    agent: "erpnext-architect"
    inputs:
      - "Business requirements document"
      - "User stories"
      - "Integration requirements"
    outputs:
      - "Requirements analysis report"
      - "Technical scope document"
      - "Integration points identified"
    tasks:
      - "analyze_business_requirements"
      - "identify_integration_points"
      - "define_technical_scope"
    validation:
      - "All requirements clearly understood"
      - "Integration points with docflow/n8n_integration identified"
      - "Technical feasibility confirmed"
  
  2_architecture_design:
    name: "Architecture Design"
    description: "Design system architecture and data models"
    agent: "erpnext-architect"
    dependencies: ["1_requirements_analysis"]
    inputs:
      - "Requirements analysis report"
      - "Existing system architecture"
    outputs:
      - "System architecture diagram"
      - "Data model design"
      - "API design specifications"
    tasks:
      - "design_system_architecture"
      - "create_data_model"
      - "plan_api_structure"
    validation:
      - "Architecture follows Frappe/ERPNext patterns"
      - "Integration with existing apps planned"
      - "Performance considerations addressed"
  
  3_doctype_design:
    name: "DocType Design"
    description: "Design and create DocTypes"
    agent: "doctype-designer"
    dependencies: ["2_architecture_design"]
    inputs:
      - "Data model design"
      - "Field specifications"
    outputs:
      - "DocType specifications"
      - "Field validation rules"
      - "Permission matrix"
    tasks:
      - "design_doctype_schema"
      - "define_field_validations"
      - "setup_permissions"
    validation:
      - "All DocTypes properly designed"
      - "Relationships correctly modeled"
      - "Permissions follow security best practices"
  
  4_doctype_implementation:
    name: "DocType Implementation"
    description: "Implement DocTypes and controllers"
    agent: "doctype-designer"
    dependencies: ["3_doctype_design"]
    inputs:
      - "DocType specifications"
      - "Business logic requirements"
    outputs:
      - "DocType JSON files"
      - "Python controller files"
      - "Client-side JavaScript files"
    tasks:
      - "create_doctype_files"
      - "implement_controllers"
      - "add_client_scripts"
    validation:
      - "All DocTypes created successfully"
      - "Controllers implement required logic"
      - "Client scripts function correctly"
  
  5_api_development:
    name: "API Development"
    description: "Create REST APIs and integration endpoints"
    agent: "api-developer"
    dependencies: ["4_doctype_implementation"]
    inputs:
      - "API specifications"
      - "Integration requirements"
    outputs:
      - "API endpoint files"
      - "Authentication handlers"
      - "Integration webhooks"
    tasks:
      - "implement_api_endpoints"
      - "setup_authentication"
      - "create_webhook_handlers"
    validation:
      - "All APIs working correctly"
      - "Authentication properly implemented"
      - "Integration endpoints tested"
  
  6_workflow_integration:
    name: "Workflow Integration"
    description: "Integrate with docflow and setup workflows"
    agent: "workflow-specialist"
    dependencies: ["5_api_development"]
    inputs:
      - "Workflow requirements"
      - "Existing docflow patterns"
    outputs:
      - "Workflow configurations"
      - "Approval processes"
      - "Notification setups"
    tasks:
      - "design_workflows"
      - "integrate_with_docflow"
      - "setup_notifications"
    validation:
      - "Workflows function correctly"
      - "Integration with docflow working"
      - "Notifications sending properly"
  
  7_automation_setup:
    name: "Automation Setup"
    description: "Setup n8n_integration triggers and automation"
    agent: "workflow-specialist"
    dependencies: ["6_workflow_integration"]
    inputs:
      - "Automation requirements"
      - "n8n_integration capabilities"
    outputs:
      - "Webhook configurations"
      - "Automation triggers"
      - "External integration setups"
    tasks:
      - "configure_webhooks"
      - "setup_automation_triggers"
      - "test_external_integrations"
    validation:
      - "Automation triggers working"
      - "External integrations functional"
      - "Webhook security implemented"
  
  8_comprehensive_validation:
    name: "Comprehensive Validation"
    description: "Comprehensive validation and testing with validation specialists"
    agent: "testing-specialist"
    supporting_agents: ["frappe-compliance-validator"]
    dependencies: ["7_automation_setup"]
    inputs:
      - "Complete application"
      - "Test requirements"
      - "Validation criteria"
    outputs:
      - "Comprehensive validation report"
      - "Compliance assessment"
      - "Security validation results"
      - "Performance benchmarks"
    tasks:
      - "comprehensive-validation-orchestration"
      - "validate-erpnext-story"
      - "create_unit_tests"
      - "run_integration_tests"
      - "perform_performance_testing"
      - "validate_multi_app_compatibility"
    validation_gates:
      frappe_compliance:
        - "Frappe compliance score ≥95%"
        - "Zero anti-pattern violations"
        - "All API endpoints use @frappe.whitelist()"
        - "No external libraries when Frappe equivalents exist"
      security_validation:
        - "Zero critical security vulnerabilities"
        - "Authentication and authorization validated"
        - "Input sanitization effective"
        - "SQL injection and XSS protection verified"
      performance_validation:
        - "API response times ≤200ms (95th percentile)"
        - "Database query optimization validated"
        - "Memory usage within acceptable limits"
        - "Concurrent user performance validated"
      integration_validation:
        - "Multi-app compatibility confirmed"
        - "docflow integration functional"
        - "n8n_integration webhook compatibility verified"
        - "ERPNext core module compatibility confirmed"
    validation:
      - "All validation gates passed"
      - "Compliance score ≥95%"
      - "Zero critical security issues"
      - "Performance benchmarks met"
      - "Integration tests successful"
  
  9_pre_deployment_verification:
    name: "Pre-Deployment Verification"
    description: "Final validation before production deployment"
    agent: "testing-specialist"
    supporting_agents: ["frappe-compliance-validator", "erpnext-qa-lead"]
    dependencies: ["8_comprehensive_validation"]
    inputs:
      - "Validated application"
      - "Deployment requirements"
      - "Production environment specifications"
    outputs:
      - "Deployment readiness report"
      - "Production validation results"
      - "Rollback verification"
      - "Monitoring configuration"
    tasks:
      - "pre-deployment-verification"
      - "validate_deployment_scripts"
      - "test_production_environment"
      - "verify_rollback_procedures"
    validation_gates:
      deployment_readiness:
        - "All previous validation gates passed"
        - "Deployment scripts validated"
        - "Production environment compatibility confirmed"
        - "Rollback procedures tested and verified"
      operational_readiness:
        - "Monitoring and alerting configured"
        - "Documentation complete and accurate"
        - "Support procedures documented"
        - "Emergency response procedures ready"
    validation:
      - "Deployment readiness confirmed"
      - "Production environment validated"
      - "Rollback procedures verified"
      - "Operational readiness achieved"
  
  10_production_deployment:
    name: "Production Deployment"
    description: "Deploy application to production with validation monitoring"
    agent: "bench-operator"
    supporting_agents: ["testing-specialist", "frappe-compliance-validator"]
    dependencies: ["9_pre_deployment_verification"]
    inputs:
      - "Deployment-ready application"
      - "Verified deployment procedures"
      - "Production environment"
    outputs:
      - "Production deployment"
      - "Active monitoring setup"
      - "Validated rollback capability"
      - "Production validation report"
    tasks:
      - "deploy_to_production"
      - "setup_monitoring"
      - "create_rollback_procedures"
      - "validate_production_deployment"
    post_deployment_validation:
      - "Application deployed successfully"
      - "All existing apps still functional"
      - "Monitoring operational and alerting"
      - "Production performance within targets"
      - "Security monitoring active"
      - "Integration endpoints responsive"
    validation:
      - "Production deployment successful"
      - "All validation monitoring active"
      - "Performance targets met in production"
      - "Security posture maintained"

environment:
  bench_path: "/home/frappe/frappe-bench"
  site: "prima-erpnext.pegashosting.com"
  existing_apps:
    - "frappe"
    - "erpnext"
    - "docflow" 
    - "n8n_integration"

validation_checkpoints:
  - stage: "1_requirements_analysis"
    checkpoint: "Requirements Validation"
    description: "Validate requirements completeness and feasibility"
    validation_team: ["erpnext-architect", "frappe-compliance-validator"]
    criteria:
      - "All business requirements clearly defined"
      - "Technical feasibility confirmed"
      - "Security requirements identified"
      - "Integration points with existing apps mapped"
    
  - stage: "3_doctype_design"
    checkpoint: "Design Validation Review"
    description: "Comprehensive design validation with stakeholders and compliance"
    validation_team: ["doctype-designer", "frappe-compliance-validator", "erpnext-architect"]
    criteria:
      - "DocType designs follow Frappe patterns"
      - "Data model relationships validated"
      - "Security and permissions properly designed"
      - "Performance considerations addressed"
    
  - stage: "5_api_development"
    checkpoint: "API Compliance Validation"
    description: "Validate API compliance with Frappe standards and security"
    validation_team: ["api-developer", "frappe-compliance-validator"]
    criteria:
      - "All APIs use @frappe.whitelist() decorator"
      - "Authentication and authorization implemented"
      - "Input validation and sanitization in place"
      - "API documentation complete"
    
  - stage: "6_workflow_integration"
    checkpoint: "Integration Validation Review"
    description: "Comprehensive integration validation with existing systems"
    validation_team: ["workflow-specialist", "testing-specialist"]
    criteria:
      - "docflow integration tested and functional"
      - "n8n_integration compatibility verified"
      - "No conflicts with existing apps"
      - "Performance impact assessed"
    
  - stage: "8_comprehensive_validation"
    checkpoint: "Comprehensive Quality Gate"
    description: "All validation gates must pass before deployment consideration"
    validation_team: ["testing-specialist", "frappe-compliance-validator", "erpnext-qa-lead"]
    criteria:
      - "Frappe compliance score ≥95%"
      - "Zero critical security vulnerabilities"
      - "Performance benchmarks met"
      - "Multi-app compatibility confirmed"
      - "All automated tests passing"
    
  - stage: "9_pre_deployment_verification"
    checkpoint: "Production Readiness Gate"
    description: "Final validation before production deployment"
    validation_team: ["testing-specialist", "frappe-compliance-validator", "bench-operator"]
    criteria:
      - "All validation checkpoints passed"
      - "Deployment procedures validated"
      - "Rollback procedures verified"
      - "Production environment compatibility confirmed"
      - "Monitoring and alerting ready"

validation_rollback_points:
  - stage: "Before DocType creation"
    validation: "Design validation passed"
  - stage: "Before API implementation"
    validation: "Architecture validation confirmed"
  - stage: "Before workflow integration"
    validation: "API compliance validated"
  - stage: "Before comprehensive validation"
    validation: "Integration validation successful"
  - stage: "Before production deployment"
    validation: "All validation gates passed"

enhanced_success_criteria:
  functional_requirements:
    - "All business requirements implemented and validated"
    - "User acceptance criteria met and verified"
    - "Integration with existing apps working seamlessly"
    
  quality_requirements:
    - "Frappe Framework compliance score ≥95%"
    - "Code quality standards met (≥85% test coverage)"
    - "Documentation complete and accurate"
    
  security_requirements:
    - "Zero critical security vulnerabilities"
    - "Authentication and authorization properly implemented"
    - "Input validation and sanitization effective"
    - "Security monitoring and alerting active"
    
  performance_requirements:
    - "API response times ≤200ms (95th percentile)"
    - "Database query performance optimized"
    - "Memory usage within acceptable limits"
    - "Concurrent user performance validated"
    
  integration_requirements:
    - "Multi-app compatibility confirmed (docflow, n8n_integration)"
    - "ERPNext core module compatibility verified"
    - "No conflicts with existing functionality"
    - "Integration endpoints tested and responsive"
    
  operational_requirements:
    - "Production deployment successful"
    - "Monitoring and alerting operational"
    - "Rollback procedures tested and verified"
    - "Support documentation complete"

continuous_validation_monitoring:
  production_validation:
    - "Real-time performance monitoring"
    - "Security event monitoring and alerting"
    - "Integration health monitoring"
    - "User experience monitoring"
    
  compliance_monitoring:
    - "Continuous Frappe compliance assessment"
    - "Automated security vulnerability scanning"
    - "Performance regression detection"
    - "Integration compatibility monitoring"